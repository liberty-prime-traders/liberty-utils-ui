@if ($person(); as p) {
  <p-card>
    <div class="flex gap-3 mb-3 justify-content-between">
      <div class="flex gap-2">
        <p-avatar [label]="p.fullName | initials" shape="circle" size="large" class="text-lg bg-primary text-white"/>

        <div class="flex flex-column justify-content-center gap-1">
          <div class="text-xl font-semibold">{{ p.fullName }}</div>
          @if (p.phoneNumber) {
            <div class="text-sm flex align-items-center">
              <i class="pi pi-phone mr-1"></i>{{ p.phoneNumber }}
            </div>
          }
        </div>
      </div>

      @if (lbuOktaService.isLibertyAdmin$ | async) {
        <div class="flex">
          <p-button   icon="pi pi-pencil"
                      label="Edit"
                      class="p-button-sm ml-auto"
                      (click)="onEdit()">
          </p-button>
          <p-button   icon="pi pi-times"
                      label="Delete"
                      severity="danger"
                      class="p-button-sm ml-auto"
                      (click)="onDelete()">
          </p-button>
        </div>
      }
    </div>

    <div class="p-3 mb-3 text-2xl font-bold">
      {{ p.balance | nullishToZero | balanceMessage }}
    </div>

    <div class="flex flex-column md:flex-row md:justify-between gap-4 w-full p-3 pt-0">
      <div class="flex flex-column md:flex-row gap-4">
        <div class="flex gap-2 align-items-center justify-content-between">
          <span class="font-bold">Start:</span>
          <p-datePicker [(ngModel)]="startDate" [readonlyInput]="true" [showButtonBar]="true"/>
        </div>

        <div class="flex gap-2 align-items-center justify-content-between">
          <span class="font-bold">End:</span>
          <p-datePicker [(ngModel)]="endDate" [readonlyInput]="true" [maxDate]="today"/>
        </div>
      </div>

      <div class="flex justify-content-end">
        <p-button label="Apply" icon="pi pi-refresh" severity="info" (click)="fetchTransactions()"/>
      </div>
    </div>

    <p-table  [value]="$transactions()"
              [scrollable]="true"
              scrollHeight="550px">

      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="transactionDate" style="min-width: 150px">
            Date <p-sortIcon field="transactionDate"/>
          </th>

          <th pSortableColumn="transactionType" style="min-width: 200px">
            Summary <p-sortIcon field="transactionType"/>
          </th>

          <th pSortableColumn="amount" style="min-width: 150px">
            Amount <p-sortIcon field="amount"/>
          </th>

          <th>Description</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-transaction>
        <tr>
          <td>{{ transaction.transactionDate | date: 'mediumDate' }}</td>
          <td> {{transaction.transactionType | transactionType}} </td>
          <td>
            {{ transaction.transactionType | transactionSign }}
            {{ transaction.amount | currency }}
          </td>
          <td>{{ transaction.description | nullSafe }}</td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="4" class="text-center text-500 p-4">
            No transactions found for this person.
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <p-dialog header="Edit Contact"
            class="w-full"
            [(visible)]="editContact"
            [modal]="true"
            [style]="{width: '30rem'}"
            [dismissableMask]="true">

    <dbt-contact-form [contact]="$person()" [(visible)]="editContact" [mode]=FormMode.EDIT />
  </p-dialog>

  <lbu-delete-dialog [(visible)]="deleteContact"
                 [idOfValueBeingDeleted]="$personId()"
                 [labelOfValueBeingDeleted]="$person()?.fullName"
                 [formType]="DebtTrackerQuickAddForm.CONTACT">
  </lbu-delete-dialog>
}
