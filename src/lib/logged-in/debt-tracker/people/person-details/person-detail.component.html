<div class="p-4">
  @if(person){
  <p-card>
    <ng-template pTemplate="content">
      <div class="flex align-items-center gap-3 pb-3 mb-3 border-bottom-1 surface-border">
        <div class="flex align-items-center justify-content-center border-circle bg-primary text-white font-bold text-xl" style="width: 3rem; height: 3rem;">
          {{ getInitials(person.fullName!) }}
        </div>
        <div>
          <div class="text-xl font-semibold">{{ person.fullName }}</div>
          @if(person.phoneNumber){
          <div class="text-sm text-color-secondary">
            <i class="pi pi-phone mr-2"></i>{{ person.phoneNumber }}
          </div>
          }
        </div>
      </div>

      <div class="p-3 mb-3">
        <div class="text-sm text-color-secondary mb-1">Current Balance</div>
        <div class="text-2xl font-bold">
          {{ getNetBalanceForPerson(person.id) | currency:'USD' }}
        </div>
      </div>

      <div>
        <div class="flex justify-content-between align-items-center mb-3">
          <h3 class="text-lg font-semibold m-0">Transaction History</h3>
          <p-dropdown
            [options]="sortOptions"
            [(ngModel)]="selectedSortOrder"
            optionLabel="label"
            optionValue="value"
            class="w-12rem">
          </p-dropdown>
        </div>

        <p-table
          [value]="sortedTransactions()"
          [scrollable]="true"
          scrollHeight="flex"
          [tableStyle]="{ 'min-width': '30rem' }">

          <ng-template pTemplate="header">
            <tr>
              <th>Date</th>
              <th>Person</th>
              <th>Description</th>
              <th class="text-right">Amount</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-transaction>
            <tr>
              <td>{{ transaction.transactionDate | date:'mediumDate' }}</td>
              <td>{{ transaction.contactName }}</td>
              <td>{{ transaction.description }}</td>
              <td class="text-right font-medium">
                {{ transaction.transactionType === TransactionType.DEBIT ? '-' : '+' }}
                {{ formatCurrency(transaction.amount ?? 0, 'en-US', 'USD') }}
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="4" class="text-center text-500 p-4">
                No transactions found for this person.
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </ng-template>
  </p-card>
  }
</div>
