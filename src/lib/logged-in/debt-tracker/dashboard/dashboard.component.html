<div class="grid p-3">
  <p-card class="col-12 md:col-4">
    <div class="flex justify-content-between mb-2 text-500">
      <span>Total Owed to You</span>
      <i class="pi pi-arrow-up-right text-green-500"></i>
    </div>

    <div class="text-2xl font-medium text-green-600" style="font-family: monospace;">
      ${{ $totalDebitAmount() | number:'1.2-2' }}
    </div>

    <div class="text-sm text-500">
      From {{ $uniqueDebitContactCount() }}
      @if($uniqueDebitContactCount() <= 1)
        { person }
      @else
        { people}
    </div>
  </p-card>

  <p-card class="col-12 md:col-4">
    <div class="flex justify-content-between mb-2 text-500">
      <span>Total You Owe</span>
      <i class="pi pi-arrow-down-right text-red-500"></i>
    </div>

    <div class="text-2xl font-medium text-red-600" style="font-family: monospace;">
      ${{ $totalCreditAmount() | number:'1.2-2' }}
    </div>

    <div class="text-sm text-500">
      To {{ $uniqueCreditContactCount() }}
      @if($uniqueCreditContactCount() <= 1)
        { person }
      @else
        { people}
    </div>
  </p-card>

  <p-card class="col-12 md:col-4">
    <div class="flex justify-content-between mb-2 text-500">
      <span> Net Balance</span>
      <i class="pi pi-calculator"></i>
    </div>

    <div class="text-2xl font-medium" style="font-family: monospace;">
      ${{ ($totalDebitAmount() - $totalCreditAmount()) | number:'1.2-2' }}
    </div>

    <div class="text-sm text-500">
      Updated
    </div>
  </p-card>

  <p-card class="col-12">
    <div class="text-xl font-bold mb-3">
      Recent Activity
    </div>

    <p-table [value]="$recentTransactions()" class="p-datatable-sm" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th>Date</th>
          <th>Person</th>
          <th>Description</th>
          <th class="text-right">Amount</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-t>
        <tr>
          <td>{{ t.transactionDate | date:'mediumDate' }}</td>
          <td>{{ t.contactName }}</td>
          <td>{{ t.description }}</td>
          <td class="text-right text-lg" style="font-family: monospace;">
            {{ t.transactionType | transactionSign}}
            {{ t.amount | currency:'USD' }}
          </td>
        </tr>
      </ng-template>
    </p-table>
    <div class="text-center py-4">
      <a [routerLink]="['../transactions']" class="no-underline">
        View Transactions
      </a>
    </div>
    @if($recentTransactions().length === 0) {
      <div class="text-center text-500 py-4">
        No transactions.
      </div>
    }
  </p-card>

  <p-card class="col-12 md:col-6">
    <div class="text-xl font-bold mb-3">
      Top Debtors
    </div>
    @for (d of $topDebtors(); track d.id) {
      <div class="flex justify-content-between py-2">
        <div class="flex align-items-center gap-2">
          <p-avatar [label]="d.name | initials"
                    shape="circle" size="large"
                    class="text-sm bg-primary text-white"/>
          <div>
            <div class="font-medium">
              {{ d.name }}
            </div>
            <div class="text-xs text-500">
              Last transaction: {{ d.lastTransactionDate | date }}
            </div>
          </div>
        </div>
        <div class="text-right">
          <div class="text-green-600 text-lg" style="font-family: monospace;">
            ${{ d.total | number:'1.2-2' }}
          </div>
          <a [routerLink]="['../contacts', d.id]" class="no-underline">
            Details
          </a>
        </div>
      </div>
    }
  </p-card>

  <p-card class="col-12 md:col-6">
    <div class="text-xl font-bold mb-3">
      Top Creditors
    </div>
    @for (c of $topCreditors(); track c.id) {
      <div class="flex justify-content-between py-2">
        <div class="flex align-items-center gap-2">
          <p-avatar [label]="c.name | initials"
                    shape="circle"
                    size="large"
                    class="text-sm bg-primary text-white"/>
          <div>
            <div class="font-medium">
              {{ c.name }}
            </div>
            <div class="text-xs text-500">
              Last transaction: {{ c.lastTransactionDate | date }}
            </div>
          </div>
        </div>
        <div class="text-right">
          <div class="text-red-600 text-lg" style="font-family: monospace;">
            ${{ c.total | number:'1.2-2' }}
          </div>
          <a [routerLink]="['../contacts', c.id]" class="no-underline">
            Details
          </a>
        </div>
      </div>
    }
  </p-card>
</div>
